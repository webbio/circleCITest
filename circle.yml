# Set the folder under which commands will be executed
general:
  build_dir: site

# Configure the machine
machine:
  timezone:
    Europe/Amsterdam
  node:
    version: 6.0.0
  python:
    version: 2.7.10

dependencies:
  pre:
    # Allow ansible playbooks to be run
    - pip install ansible
    # Turn an environment variable into a vault file that ansible can read
    - cd ../trellis && echo "${ANSIBLE_VAULT_PASSWORD}" > .vault_pass
  # This _should_ be inferred by Circle CI as we specify a node version but for some reason, it never ran for me. This tells it explicitly to run.
  override:
    - npm install
    - npm install gulp -g
    - npm install bower -g

# Deployment Scenarios
deployment:
  staging:
    branch: master
    commands:
      # - cd ../trellis && ansible-playbook server.yml -e env=staging
      # This is just an ansible playbook command with some options to specify where the host file is located and that we want to skip tasks with the tag `skip-using-ci`
      - cd ../trellis && ansible-playbook deploy.yml -e "site=webbio-staging.nl env=staging" -i hosts/staging --skip-tags "skip-using-ci" -vvv
